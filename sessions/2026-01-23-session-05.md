# 📝 学习会话记录

> **日期**: 2026-01-23  
> **会话编号**: Session 05  
> **时长**: 约 20 分钟  
> **主题**: 规范完结 - 序列化示例与 CDR 字节对齐

---

## 🎯 本次学习目标

- [x] 完成 DDS-RTPS 规范最后部分（第 7957-8056 行）
- [x] 理解内置端点数据的实际字节布局
- [x] 理解用户数据的 CDR 序列化示例
- [x] 掌握如何区分 Discovery 和用户数据

---

## 📚 学习内容

### 1. 两个序列化示例对比

| 示例 | RepresentationId | 格式 | 用途 |
|------|-----------------|------|------|
| 10.6 内置端点 | `PL_CDR_LE` (0x00 0x03) | ParameterList | Discovery |
| 10.7 用户数据 | `CDR_LE` (0x00 0x01) | 纯 CDR | 应用数据 |

### 2. 如何区分 Discovery 和用户数据

**关键**：看 SerializedPayload 的**前 2 个字节**（RepresentationIdentifier）

```
PL_CDR_LE = {0x00, 0x03} → ParameterList 格式 → Discovery 数据
CDR_LE    = {0x00, 0x01} → 纯 CDR 格式      → 用户数据
```

### 3. CDR 字符串序列化

以 `"BLUE"` 为例：

```
偏移 4:  ┌─────────────────────────────┐
         │ 0x05 0x00 0x00 0x00         │ ← 长度 = 5（含 '\0'）
偏移 8:  ├─────────────────────────────┤
         │ 'B'  'L'  'U'  'E'          │ ← 字符内容
偏移 12: ├─────────────────────────────┤
         │ '\0' pad  pad  pad          │ ← 结束符 + 3 字节填充
偏移 16: └─────────────────────────────┘ ← 下一字段（4 字节对齐）
```

**总计**：4（长度）+ 4（内容）+ 1（'\0'）+ 3（填充）= **12 字节**

### 4. 为什么需要填充？

CDR 要求字段按**自然边界对齐**：
- `long`（4 字节）→ 必须从 4 的倍数地址开始
- 字符串结束于偏移 13，下一个 4 的倍数是 16
- 所以需要 3 字节填充

---

## 🔑 核心概念总结

| 概念 | 说明 |
|------|------|
| **RepresentationIdentifier** | 前 2 字节标识数据格式 |
| **PL_CDR** | ParameterList + CDR，用于 Discovery |
| **CDR** | 纯 CDR 序列化，用于用户数据 |
| **字节对齐** | 字段按自然边界对齐，不足部分填充 |

---

## 🎉 里程碑达成

### DDS-RTPS 规范全文学习完成！

```
📖 DDS-RTPS v2.5 规范
├── 第 1-7 章：背景与概述           ✅
├── 第 8 章：PIM（平台无关模型）    ✅
│   ├── 结构模块
│   ├── 消息模块
│   ├── 行为模块
│   └── 发现模块
├── 第 9 章：PSM（UDP/IP 映射）     ✅
│   ├── 类型映射
│   ├── 子消息线路格式
│   └── 端口计算
├── 第 10 章：SerializedPayload     ✅
│   ├── RepresentationIdentifier
│   └── 序列化示例
└── 附录 A：参考文献                ✅

总计：8056 行，5 次会话，2 天
```

---

## 📊 学习统计

| 指标 | 数值 |
|------|------|
| 规范总行数 | 8056 |
| 学习会话数 | 5 |
| 学习天数 | 2 |
| 掌握技能数 | 50+ |

---

## 🎯 下一步建议

理论学习已完成，**强烈建议进入实践阶段**：

### 立即可做
1. **编译 Cyclone DDS**
   ```bash
   pixi shell
   ./build.sh build
   ```

2. **运行 HelloWorld 示例**
   ```bash
   ./build.sh build -DBUILD_EXAMPLES=ON
   ```

3. **Wireshark 抓包验证**
   - 过滤器：`rtps`
   - 验证消息格式与所学一致

### 后续深入
- Cyclone DDS 源码分析
- DDS Security 扩展学习
- ROS 2 集成实践

---

## 💡 心得体会

完成了 DDS-RTPS 规范的全文学习！最后这部分通过两个具体的序列化示例，将前面学到的理论知识串联起来：

1. **RepresentationIdentifier 是关键**：通过前 2 字节就能判断数据格式
2. **CDR 对齐规则**：理解了为什么字符串 "BLUE" 需要 12 字节
3. **理论到实践的桥梁**：这些字节级的细节在 Wireshark 抓包时会直接看到

两天时间完成了 8000+ 行规范的学习，建立了扎实的 RTPS 协议理论基础。现在最需要的是通过实践来巩固这些知识！

---

## 📖 参考资料

- DDS-RTPS 规范 v2.5
  - 10.6 内置端点数据示例
  - 10.7 用户自定义 Topic 数据示例
  - 附录 A 参考文献
